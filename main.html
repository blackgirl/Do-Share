<!doctype html>
<head>
  <title>Night Watch</title>
  <!-- TODO: Need icon -->
  <link rel="icon" href="icon128.png" />
  <script>
function d(){
  document.getElementById("timeParsed").innerHTML = new Date(document.getElementById('time').value).toString();
}
function val(name) {
  var $ = document.getElementById(name).value;
  return ($ ? $ : undefined);
}
function post(){
  var post = {
    'content': val('content'),
    'share_id': val('share_id'),
    'timeStamp': new Date(val('time')).getTime()
  }
  var link = val('link');
  if (link) {
    post.link = link;
  }
  chrome.extension.sendRequest({'type': 'post', 'post': post, 'time': post.timeStamp}, function(){});
}

function renderPost(post) {
  var p = document.createElement('p');
  p.innerHTML = new Date(post.timeStamp).toString() + '<br >' + post.content;
  return p;
}

function drafts() {
  chrome.extension.sendRequest({'type': 'fetchAll'}, function(result) {
    var postsDiv = document.getElementById('posts');
    result.posts.forEach(function(post) {
      console.log(post);
      postsDiv.appendChild(renderPost(post));
    });
  });
}
  </script>
</head>
<body>
  <div>
    <p><textarea id='content' cols="30" rows="10">Content</textarea></p>
    <p><input id='time' placeholder="Time" /><button onclick='d()'>Parse</button></p>
    <p id='timeParsed'></p>
    <p><input id='share_id' placeholder="shared id" /></p>
    <p><input id='link' placeholder="link" /></p>
</div>
<div id="posts">
</div>
